all_Rdata = Sys.glob('../SOURCE_ZONES/*/TSUNAMI_EVENTS/plots/*.Rdata')

uniform_store = list()
stochastic_store = list()
variable_uniform_store = list()

for(i in 1:length(all_Rdata)){

    print(all_Rdata[i])
    event_env = new.env()

    load(all_Rdata[i], envir=event_env)

    ngauges = length(event_env$uniform_slip_stats)

    uniform_store[[i]] = list(
        data= matrix(NA, ncol=ngauges, nrow=length(event_env$uniform_slip_stats[[1]])),
        model=matrix(NA, ncol=ngauges, nrow=length(event_env$uniform_slip_stats[[1]])),
        nunique_models = rep(NA, ngauges)
        )
    stochastic_store[[i]] = list(
        data= matrix(NA, ncol=ngauges, nrow=length(event_env$stochastic_slip_stats[[1]])),
        model=matrix(NA, ncol=ngauges, nrow=length(event_env$stochastic_slip_stats[[1]])),
        nunique_models = rep(NA, ngauges)
        )
    variable_uniform_store[[i]] = list(
        data= matrix(NA, ncol=ngauges, nrow=length(event_env$variable_uniform_slip_stats[[1]])),
        model=matrix(NA, ncol=ngauges, nrow=length(event_env$variable_uniform_slip_stats[[1]])),
        nunique_models = rep(NA, ngauges)
        )

    for(gauge_ind in 1:ngauges){

        # Uniform
        uniform_store[[i]]$data[,gauge_ind] = 
            unlist(lapply(event_env$uniform_slip_stats[[gauge_ind]],
                f<-function(x) diff(x$data_range)))
        uniform_store[[i]]$model[,gauge_ind] = 
            unlist(lapply(event_env$uniform_slip_stats[[gauge_ind]], 
                f<-function(x) diff(x$model_range)))

        uniform_store[[i]]$nunique_models[gauge_ind] = 
            length(unique(uniform_store[[i]]$model[,gauge_ind]))

        # Stochastic
        stochastic_store[[i]]$data[,gauge_ind] = 
            unlist(lapply(event_env$stochastic_slip_stats[[gauge_ind]],
                f<-function(x) diff(x$data_range)))
        stochastic_store[[i]]$model[,gauge_ind] = 
            unlist(lapply(event_env$stochastic_slip_stats[[gauge_ind]], 
                f<-function(x) diff(x$model_range)))
        stochastic_store[[i]]$nunique_models[gauge_ind] = 
            length(unique(stochastic_store[[i]]$model[,gauge_ind]))

        # variable_uniform
        variable_uniform_store[[i]]$data[,gauge_ind] = 
            unlist(lapply(event_env$variable_uniform_slip_stats[[gauge_ind]],
                f<-function(x) diff(x$data_range)))
        variable_uniform_store[[i]]$model[,gauge_ind] = 
            unlist(lapply(event_env$variable_uniform_slip_stats[[gauge_ind]], 
                f<-function(x) diff(x$model_range)))
        variable_uniform_store[[i]]$nunique_models[gauge_ind] = 
            length(unique(variable_uniform_store[[i]]$model[,gauge_ind]))
        
    }

}

#
# Compute the fraction of model events that had stage-range exceeding the data.
# If multiple gauges exist, take the median value over all gauges.
#
meds_uniform          = unlist(lapply(uniform_store         , f<-function(x) median(colMeans(x$model > x$data))))
## PRELIMINARY
# [1] 0.4166667 0.8333333 0.0000000 0.0000000 0.9285714 0.1785714 0.3157895 0.8333333 0.3484848 0.0000000 0.5000000 0.5714286
## SECOND RUN
# [1] 0.3333333 0.8333333 0.0000000 0.0000000 0.6666667 0.2142857 0.2894737 0.8333333 0.3030303 0.0000000 0.5000000 0.5000000
meds_stochastic       = unlist(lapply(stochastic_store      , f<-function(x) median(colMeans(x$model > x$data))))
## PRELIMINARY
# [1] 0.6444444 0.8944444 0.6176471 0.1111111 0.7952381 0.1761905 0.4438596 0.8244444 0.4939394 0.2825397 0.7595238 0.5833333
## SECOND RUN
# [1] 0.6666667 0.9444444 0.5843137 0.1333333 0.8888889 0.3095238 0.4561404 0.8633333 0.4595960 0.2603175 0.7809524 0.5142857
meds_variable_uniform = unlist(lapply(variable_uniform_store, f<-function(x) median(colMeans(x$model > x$data))))
## PRELIMINARY
# [1] 0.35555556 0.65555556 0.18823529 0.02222222 0.49047619 0.11904762 0.25964912 0.61666667 0.27474747 0.14920635 0.50714286 0.44047619
## SECOND RUN
# [1] 0.34444444 0.73888889 0.22745098 0.01666667 0.55555556 0.19047619 0.24561404 0.62000000 0.26868687 0.12698413 0.49761905 0.40952381

meds2_uniform          = (lapply(uniform_store         , f<-function(x) (colMeans(x$model > x$data))))
meds2_stochastic       = (lapply(stochastic_store      , f<-function(x) (colMeans(x$model > x$data))))
meds2_variable_uniform = (lapply(variable_uniform_store, f<-function(x) (colMeans(x$model > x$data))))
###             ###
### PRELIMINARY ###
###             ###
## > meds2_uniform
## [[1]]
## [1] 0.7500000 0.6666667 0.4166667 0.2500000 0.0000000
## 
## [[2]]
## [1] 0.8333333
## 
## [[3]]
##  [1] 0.11764706 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.23529412 0.00000000 0.05882353 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000
## [17] 0.00000000 0.00000000 0.00000000 0.00000000 0.58823529 0.29411765 0.00000000 0.29411765 0.35294118 0.41176471 0.52941176 0.64705882
## 
## [[4]]
## [1] 0 0 0 0 0
## 
## [[5]]
## [1] 0.9285714
## 
## [[6]]
## [1] 0.0000000 0.3571429
## 
## [[7]]
## [1] 0.05263158 0.50000000 0.13157895 0.00000000 0.34210526 0.44736842 0.21052632 0.31578947 0.31578947
## 
## [[8]]
## [1] 0.7333333 0.8666667 0.8000000 0.9666667
## 
## [[9]]
##  [1] 0.93939394 0.27272727 0.12121212 0.24242424 0.33333333 0.06060606 0.72727273 0.33333333 0.66666667 0.24242424 0.48484848 0.36363636 0.36363636 0.51515152 0.39393939 0.30303030
## 
## [[10]]
## [1] 0
## 
## [[11]]
## [1] 0.5
## 
## [[12]]
## [1] 0.8571429 0.2857143
## 
## > meds2_stochastic
## [[1]]
## [1] 0.8444444 0.7944444 0.6444444 0.4944444 0.2166667
## 
## [[2]]
## [1] 0.8944444
## 
## [[3]]
##  [1] 0.6823529 0.6588235 0.5333333 0.3921569 0.3686275 0.5490196 0.8980392 0.6235294 0.8078431 0.5058824 0.6705882 0.3529412 0.6039216 0.6117647 0.5137255 0.5568627 0.6862745
## [18] 0.6000000 0.2784314 0.4392157 0.9254902 0.7607843 0.4901961 0.8352941 0.8901961 0.8470588 0.9607843 0.9333333
## 
## [[4]]
## [1] 0.22222222 0.06666667 0.13333333 0.11111111 0.04444444
## 
## [[5]]
## [1] 0.7952381
## 
## [[6]]
## [1] 0.05714286 0.29523810
## 
## [[7]]
## [1] 0.4280702 0.6789474 0.4245614 0.2789474 0.4982456 0.4438596 0.4140351 0.6421053 0.5421053
## 
## [[8]]
## [1] 0.8044444 0.9133333 0.8444444 0.8022222
## 
## [[9]]
##  [1] 0.8606061 0.5595960 0.4545455 0.5838384 0.6929293 0.5313131 0.7070707 0.4949495 0.6828283 0.3191919 0.4323232 0.4444444 0.4181818 0.4929293 0.4646465 0.4484848
## 
## [[10]]
## [1] 0.2825397
## 
## [[11]]
## [1] 0.7595238
## 
## [[12]]
## [1] 0.7952381 0.3714286
## 
## > meds2_variable_uniform
## [[1]]
## [1] 0.71111111 0.58888889 0.35555556 0.20555556 0.06666667
## 
## [[2]]
## [1] 0.6555556
## 
## [[3]]
##  [1] 0.35686275 0.25882353 0.12941176 0.05490196 0.15686275 0.16078431 0.62745098 0.18431373 0.55686275 0.16078431 0.23921569 0.05882353 0.15294118 0.19215686 0.14901961 0.12156863
## [17] 0.24705882 0.18039216 0.04705882 0.11764706 0.64313725 0.50980392 0.12941176 0.41176471 0.42745098 0.40784314 0.75294118 0.78823529
## 
## [[4]]
## [1] 0.04444444 0.02222222 0.04444444 0.02222222 0.00000000
## 
## [[5]]
## [1] 0.4904762
## 
## [[6]]
## [1] 0.04285714 0.19523810
## 
## [[7]]
## [1] 0.1508772 0.5245614 0.1929825 0.1228070 0.3192982 0.2596491 0.2087719 0.3157895 0.3526316
## 
## [[8]]
## [1] 0.5666667 0.8244444 0.5533333 0.6666667
## 
## [[9]]
##  [1] 0.7636364 0.2626263 0.1959596 0.3030303 0.3737374 0.2161616 0.4545455 0.2404040 0.4848485 0.1838384 0.2808081 0.3212121 0.2424242 0.3212121 0.2686869 0.2626263
## 
## [[10]]
## [1] 0.1492063
## 
## [[11]]
## [1] 0.5071429
## 
## [[12]]
## [1] 0.6428571 0.2380952
##
##
#######################################################################################################################
###              ###
### SECOND RUN   ###
###              ###
## 
## > meds2_uniform
## [[1]]
## [1] 0.7500000 0.5833333 0.3333333 0.1666667 0.0000000
## 
## [[2]]
## [1] 0.8333333
## 
## [[3]]
##  [1] 0.11764706 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 1.00000000 0.00000000 0.05882353 0.00000000
## [11] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000
## [21] 0.52941176 0.29411765 0.00000000 0.29411765 0.35294118 0.35294118 0.52941176 0.70588235
## 
## [[4]]
## [1] 0 0 0 0 0
## 
## [[5]]
## [1] 0.6666667
## 
## [[6]]
## [1] 0.0000000 0.4285714
## 
## [[7]]
## [1] 0.02631579 0.50000000 0.13157895 0.02631579 0.52631579 0.36842105 0.44736842 0.28947368 0.28947368
## 
## [[8]]
## [1] 0.7333333 0.8666667 0.8000000 0.9666667
## 
## [[9]]
##  [1] 0.96969697 0.24242424 0.03030303 0.24242424 0.30303030 0.06060606 0.66666667 0.27272727 0.66666667 0.24242424
## [11] 0.51515152 0.39393939 0.27272727 0.48484848 0.33333333 0.30303030
## 
## [[10]]
## [1] 0
## 
## [[11]]
## [1] 0.5
## 
## [[12]]
## [1] 0.7142857 0.2857143
## 
## > meds2_stochastic
## [[1]]
## [1] 0.8555556 0.8166667 0.6666667 0.5277778 0.1944444
## 
## [[2]]
## [1] 0.9444444
## 
## [[3]]
##  [1] 0.6862745 0.5843137 0.5176471 0.3686275 0.3333333 0.5843137 0.9607843 0.6431373 0.8352941 0.5137255 0.6156863
## [12] 0.3882353 0.5333333 0.5372549 0.4941176 0.5058824 0.6078431 0.5490196 0.2745098 0.4156863 0.8941176 0.7647059
## [23] 0.4392157 0.8078431 0.8784314 0.8078431 0.9764706 0.9333333
## 
## [[4]]
## [1] 0.13333333 0.06666667 0.21666667 0.16666667 0.03333333
## 
## [[5]]
## [1] 0.8888889
## 
## [[6]]
## [1] 0.1333333 0.4857143
## 
## [[7]]
## [1] 0.4175439 0.6684211 0.4052632 0.2403509 0.5280702 0.4561404 0.4333333 0.5964912 0.4877193
## 
## [[8]]
## [1] 0.8244444 0.9266667 0.8711111 0.8555556
## 
## [[9]]
##  [1] 0.8464646 0.5212121 0.3979798 0.5090909 0.6828283 0.5090909 0.6787879 0.4525253 0.6666667 0.3151515 0.4646465
## [12] 0.4242424 0.3919192 0.4404040 0.4545455 0.4404040
## 
## [[10]]
## [1] 0.2603175
## 
## [[11]]
## [1] 0.7809524
## 
## [[12]]
## [1] 0.7095238 0.3190476
## 
## > meds2_variable_uniform
## [[1]]
## [1] 0.65000000 0.55000000 0.34444444 0.20000000 0.01666667
## 
## [[2]]
## [1] 0.7388889
## 
## [[3]]
##  [1] 0.35686275 0.23921569 0.15294118 0.09411765 0.16862745 0.20000000 0.89019608 0.23529412 0.56470588 0.21960784
## [11] 0.29803922 0.09411765 0.17647059 0.18431373 0.18823529 0.14117647 0.25098039 0.20784314 0.07450980 0.15686275
## [21] 0.64313725 0.50196078 0.12941176 0.45490196 0.51372549 0.45882353 0.78431373 0.86666667
## 
## [[4]]
## [1] 0.06666667 0.01666667 0.06666667 0.01666667 0.01666667
## 
## [[5]]
## [1] 0.5555556
## 
## [[6]]
## [1] 0.06190476 0.31904762
## 
## [[7]]
## [1] 0.1421053 0.5105263 0.1807018 0.1087719 0.3771930 0.2421053 0.2508772 0.2456140 0.2982456
## 
## [[8]]
## [1] 0.5222222 0.8422222 0.5888889 0.6511111
## 
## [[9]]
##  [1] 0.8000000 0.2464646 0.1636364 0.2949495 0.3555556 0.2040404 0.4242424 0.2121212 0.5111111 0.1777778 0.3050505
## [12] 0.3070707 0.2303030 0.2848485 0.2505051 0.2525253
## 
## [[10]]
## [1] 0.1269841
## 
## [[11]]
## [1] 0.497619
## 
## [[12]]
## [1] 0.5761905 0.2428571


save.image('model_data_envelope_summary_statistics.Rdata')

#
# Info on number of unique models [since double-ups can occur, e.g.
# if 2 variable_uniform slip models have the same area and Mw. This
# even happens for single unit-source stochastic models
#
for(i in 1:12){
    print(paste0('################', i))
    print(basename(all_Rdata[i]))
    print(c(uniform_store[[i]]$nunique_models, '/', length(uniform_store[[i]]$model[,1])))
    print(c(stochastic_store[[i]]$nunique_models, '/', length(stochastic_store[[i]]$model[,1])))
    print(c(variable_uniform_store[[i]]$nunique_models, '/', length(variable_uniform_store[[i]]$model[,1])))
}
###
### PRELIMINARY RUN ###
###
## [1] "################1"
## [1] "gauge_summary_stats_session_kermadectonga_samoa_2009_09_29_Mw8.1.Rdata"
## [1] "12" "12" "12" "12" "12" "/"  "12"
## [1] "180" "180" "180" "180" "180" "/"   "180"
## [1] "127" "127" "127" "127" "127" "/"   "180"
## [1] "################2"
## [1] "gauge_summary_stats_session_kermadectonga_tonga_2009_03_19_Mw7.7.Rdata"
## [1] "12" "/"  "12"
## [1] "178" "/"   "180"
## [1] "136" "/"   "180"
## [1] "################3"
## [1] "gauge_summary_stats_session_kurilsjapan_tohoku_2011_03_11_Mw9.1.Rdata"
##  [1] "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17"
## [16] "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "/"  "17"
##  [1] "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255"
## [13] "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255"
## [25] "255" "255" "255" "255" "/"   "255"
##  [1] "230" "230" "230" "230" "230" "230" "230" "230" "230" "230" "230" "230"
## [13] "230" "230" "230" "230" "230" "230" "230" "230" "230" "230" "230" "230"
## [25] "230" "230" "230" "230" "/"   "255"
## [1] "################4"
## [1] "gauge_summary_stats_session_newhebrides_northNewHebrides_2013_02_06_Mw7.9.Rdata"
## [1] "3" "3" "3" "3" "3" "/" "3"
## [1] "45" "45" "45" "45" "45" "/"  "45"
## [1] "31" "31" "31" "31" "31" "/"  "45"
## [1] "################5"
## [1] "gauge_summary_stats_session_newhebrides_vanuatu_north_2009_10_07_Mw7.8.Rdata"
## [1] "14" "/"  "14"
## [1] "210" "/"   "210"
## [1] "102" "/"   "210"
## [1] "################6"
## [1] "gauge_summary_stats_session_puysegur_puysegur_2009_07_15_Mw78.Rdata"
## [1] "14" "14" "/"  "14"
## [1] "205" "205" "/"   "210"
## [1] "98"  "98"  "/"   "210"
## [1] "################7"
## [1] "gauge_summary_stats_session_southamerica_chile_2010_02_27_Mw8.8.Rdata"
##  [1] "38" "38" "38" "38" "38" "38" "38" "38" "38" "/"  "38"
##  [1] "570" "570" "570" "570" "570" "570" "570" "570" "570" "/"   "570"
##  [1] "509" "509" "509" "509" "509" "509" "509" "509" "509" "/"   "570"
## [1] "################8"
## [1] "gauge_summary_stats_session_southamerica_southamerica_2014_04_01_Mw8.2.Rdata"
## [1] "30" "30" "30" "30" "/"  "30"
## [1] "450" "450" "450" "450" "/"   "450"
## [1] "361" "361" "361" "361" "/"   "450"
## [1] "################9"
## [1] "gauge_summary_stats_session_southamerica_southamerica_2015_09_16_Mw8.3.Rdata"
##  [1] "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33"
## [16] "33" "/"  "33"
##  [1] "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495"
## [13] "495" "495" "495" "495" "/"   "495"
##  [1] "412" "412" "412" "412" "412" "412" "412" "412" "412" "412" "412" "412"
## [13] "412" "412" "412" "412" "/"   "495"
## [1] "################10"
## [1] "gauge_summary_stats_session_sunda_mentawai_2010_10_25_Mw7.9.Rdata"
## [1] "21" "/"  "21"
## [1] "312" "/"   "315"
## [1] "211" "/"   "315"
## [1] "################11"
## [1] "gauge_summary_stats_session_sunda_sumatra_2007_09_12_Mw8.5.Rdata"
## [1] "28" "/"  "28"
## [1] "420" "/"   "420"
## [1] "391" "/"   "420"
## [1] "################12"
## [1] "gauge_summary_stats_session_sunda_sumatra_2010_04_06_Mw7.8.Rdata"
## [1] "14" "14" "/"  "14"
## [1] "206" "206" "/"   "210"
## [1] "140" "140" "/"   "210"
##
#######################################################################################################################
###             ###
### SECOND RUNS ###
###             ###
## [1] "################1"
## [1] "gauge_summary_stats_session_kermadectonga_samoa_2009_09_29_Mw8.1.Rdata"
## [1] "12" "12" "12" "12" "12" "/"  "12"
## [1] "180" "180" "180" "180" "180" "/"   "180"
## [1] "117" "117" "117" "117" "117" "/"   "180"
## [1] "################2"
## [1] "gauge_summary_stats_session_kermadectonga_tonga_2009_03_19_Mw7.7.Rdata"
## [1] "12" "/"  "12"
## [1] "178" "/"   "180"
## [1] "131" "/"   "180"
## [1] "################3"
## [1] "gauge_summary_stats_session_kurilsjapan_tohoku_2011_03_11_Mw9.1.Rdata"
##  [1] "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17" "17"
## [24] "17" "17" "17" "17" "17" "/"  "17"
##  [1] "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255" "255"
## [20] "255" "255" "255" "255" "255" "255" "255" "255" "255" "/"   "255"
##  [1] "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228" "228"
## [20] "228" "228" "228" "228" "228" "228" "228" "228" "228" "/"   "255"
## [1] "################4"
## [1] "gauge_summary_stats_session_newhebrides_northNewHebrides_2013_02_06_Mw7.9.Rdata"
## [1] "4" "4" "4" "4" "4" "/" "4"
## [1] "60" "60" "60" "60" "60" "/"  "60"
## [1] "41" "41" "41" "41" "41" "/"  "60"
## [1] "################5"
## [1] "gauge_summary_stats_session_newhebrides_vanuatu_north_2009_10_07_Mw7.8.Rdata"
## [1] "6" "/" "6"
## [1] "90" "/"  "90"
## [1] "65" "/"  "90"
## [1] "################6"
## [1] "gauge_summary_stats_session_puysegur_puysegur_2009_07_15_Mw7.8.Rdata"
## [1] "14" "14" "/"  "14"
## [1] "206" "206" "/"   "210"
## [1] "111" "111" "/"   "210"
## [1] "################7"
## [1] "gauge_summary_stats_session_southamerica_chile_2010_02_27_Mw8.8.Rdata"
##  [1] "38" "38" "38" "38" "38" "38" "38" "38" "38" "/"  "38"
##  [1] "570" "570" "570" "570" "570" "570" "570" "570" "570" "/"   "570"
##  [1] "488" "488" "488" "488" "488" "488" "488" "488" "488" "/"   "570"
## [1] "################8"
## [1] "gauge_summary_stats_session_southamerica_southamerica_2014_04_01_Mw8.2.Rdata"
## [1] "30" "30" "30" "30" "/"  "30"
## [1] "450" "450" "450" "450" "/"   "450"
## [1] "357" "357" "357" "357" "/"   "450"
## [1] "################9"
## [1] "gauge_summary_stats_session_southamerica_southamerica_2015_09_16_Mw8.3.Rdata"
##  [1] "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "33" "/"  "33"
##  [1] "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "495" "/"   "495"
##  [1] "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "404" "/"   "495"
## [1] "################10"
## [1] "gauge_summary_stats_session_sunda_mentawai_2010_10_25_Mw7.9.Rdata"
## [1] "21" "/"  "21"
## [1] "314" "/"   "315"
## [1] "221" "/"   "315"
## [1] "################11"
## [1] "gauge_summary_stats_session_sunda_sumatra_2007_09_12_Mw8.5.Rdata"
## [1] "28" "/"  "28"
## [1] "420" "/"   "420"
## [1] "377" "/"   "420"
## [1] "################12"
## [1] "gauge_summary_stats_session_sunda_sumatra_2010_04_06_Mw7.8.Rdata"
## [1] "14" "14" "/"  "14"
## [1] "207" "207" "/"   "210"
## [1] "148" "148" "/"   "210"
## > 
